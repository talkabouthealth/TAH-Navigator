#{set pageType = 'invite' /} #{extends 'caremain.html' /}
#{form @Care.sendInvitation() , id:'appointmentForm'}
<style>
.col-xs-3.control-label{ line-height:35px }
.bootstrap-validator-form .help-block {
  margin-bottom: 0; }
</style>
<div class="col-xs-12 col-sm-12">
 	<ul class="list-group" id="errorUL"></ul>
	<div class="modal-body" style="overflow: hidden;">
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Email</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" id="appointment_purpose" name="email" class="form-control nomargin" placeholder="i.e. example@example.com" required="required" data-error="Bruh, that email address is invalid"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
			<div class="help-block with-errors"></div>
		</div>

		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">First name</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" id="appointment_purpose" name="firstname" class="form-control nomargin" placeholder="i.e. xyz" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Last name</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" id="appointment_purpose" name="lastname" class="form-control nomargin" placeholder="i.e. xyz" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>

		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Time</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control timeField nomargin" name="time" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Date</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control nomargin" id="hasDatepicker" name="schDate" required="required">
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Physician/Nurse</label>
			<div class="col-xs-8 form-group input-group">
				#{if drList != null}
					<select class="memberselect" name="memberid">
					#{list drList, as:'seq'}
						<option value="${seq.id}"> ${seq.name.usreNameNew(seq.id)} </option>
					#{/list}
					</select>
				#{/if}
				#{else} No expert assigned #{/else}
			</div>
		</div>
		
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Purpose of Appointment</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" id="appointment_purpose" name="purposeText" class="form-control nomargin appointment_purpose"  value="1st Appointment With Radiation Oncologist" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm" id="treatment_step_process">
			<label class="col-xs-3 control-label" for="rt_schedule">Step in the Treatment Process</label>
			<div class="col-xs-8 form-group input-group">
				<select class="form-control nomargin" id="ts_process">
					<option>Prepare for First Appointment</option>
					<option>Make Treatment Decision</option>
					<option>Prepare for First Treatment</option>
					<option>Ongoing Treatments</option>
					<option>Continue Follow-Ups</option>
				</select>
			</div>
		</div>
		
		
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Center</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control nomargin" value="Moffitt Cancer Center TVRH" name="center" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Address1</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control nomargin" value="1400 US Highway 441, Suite 540" name="address1" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">City</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control nomargin" value="The Villages" name="city" required="required">
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">State</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control nomargin" value="FL" name="state" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label class="col-xs-3 control-label" for="rt_schedule">Zip Code</label>
			<div class="col-xs-8 form-group input-group">
				<input type="text" class="form-control nomargin" value="32159" name="zip" required="required"> 
				<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
			</div>
		</div>
	</div>
	<div class="modal-footer" style="text-align: center;">
		<button type="submit" class="btn btn-default">Send Invite Email</button>
	</div>
</div>
#{/form}
<script>
<!--
var timeArray = ["8 AM","8.15 AM","8.30 AM","8.45 AM","9 AM","9.15 AM","9.30 AM","9.45 AM","10 AM","10.15 AM","10.30 AM","10.45 AM","11 AM","11.15 AM","11.30 AM","11.45 AM","12 noon","12.15 PM","12.30 PM",
 				"12.45 PM","1 PM","1.15 PM","1.30 PM","1.45 PM","2 PM","2.15 PM","2.30 PM","2.45 PM","3 PM","3.15 PM","3.30 PM","3.45 PM","4 PM","5.15 PM","5.30 PM","5.45 PM","6 PM"];
$(document).ready(function() {
	
	
	LoadSelect2Script(selectExpert);
	
	$('#appointmentForm').submit(function(event) {
		event.preventDefault();
		var postData = $("#appointmentForm").serializeArray();
        var $avm = $('#appointment_verified_members');
        var $ap = $('#appointment_purpose');
        var membername = $avm.val();
        var members = $avm.data("careMembers");
        var verified = false;
        for (var id in members) {
            if(members[id] == membername) {
                $avm.attr("careMemberId", id); 
                verified = true;
                break;
            }
        }
        if (!verified) {
            $avm.removeAttr("careMemberId");
        }        
        postData.push({name: "memberid", value: $avm.attr("careMemberId") || 0});
        
        var purposes = $ap.data("purposes");
        var purpose_text = $.trim($ap.val());
        var definedPurpose = false;
        var purpose = 0;
//      for (var i = 0; i < purposes.length; i++) {
//             if (purposes[i].name == purpose_text) {
//                 definedPurpose = true;
//                 purpose = purposes[i].id;
//                 break;
//             }
//      }
        if (!definedPurpose) {
            postData.push({name: "treatmentProcessStep", value: $("#ts_process option:selected").text()});    
        }
// 		postData.push({name: "purpose", value: purpose});
        
		var formURL = $("#appointmentForm").attr("action");
		$.post(formURL, postData, function( data ) {
			var errorText = '';
			alert(data.members.status);
			if(data.members.status == '200') {
				errorText = '<li class="list-group-item list-group-item-success">Patient invitation sent.</li>';
			} else if(data.members.status == '100') {
				errorText = '<li class="list-group-item list-group-item-danger">Internal server error. Please try again.</li>';
			} else if(data.members.status == '300') {
				errorText = '<li class="list-group-item list-group-item-danger">Email already registred, Please try again.</li>';
			}
			$("#errorUL").empty();
			$("#errorUL").html(errorText);
			setTimeout(function(){$('#errorUL').empty();}, 2000);
		}, "json");
	});
	$('#appointmentForm').validator();
});
selectExpert = function() {
	$('.memberselect').select2();
	$("input.timeField").autocomplete({source: timeArray,minLenght:1 });
	$('#hasDatepicker').datepicker({defaultDate: +1 ,minDate:"+1d"});
	$.post('/care/appointmentForm', {}, function (data) {
		var purposes = data.purposes;
		var purposeList = [];
		var length = purposes.length;
		for (var i = 0; i < length; i++) {
			purposeList.push(purposes[i].name);
		}
		$("input.appointment_purpose").autocomplete({ source: purposeList, minLength: 1});
	}, "json");
}
-->
</script>
