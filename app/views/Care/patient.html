#{set pageType = 'patient1' /}
#{extends 'caremain.html' /}	

<div id="content" class="patient page">
	<div class="col-xs-12 col-sm-12">
		<div>
			<ul id="tabs" class="nav nav-tabs">
				<li class="active"><a href="#summary" data-url="@{CarePatien.summary(patientId)}">SUMMARY</a></li>
				<li><a class="appointment" href="#appointment" data-url="@{CarePatien.appointment(patientId)}">APPOINTMENTS</a></li>
				<li><a class="careteam" href="#careteam" data-url="@{CarePatien.careteam(patientId)}">CARE TEAM</a></li>
				<li><a class="medication" href="#medication" data-url="@{CarePatien.medication(patientId)}">MEDICATIONS</a></li>
				<li><a class="treatmentplan" href="#treatmentplan" data-url="@{CarePatien.treatmentPlan(patientId)}">TREATMENT PLAN</a></li>
				<li><a class="followupplan" href="#followupplan" data-url="@{CarePatien.followupPlan(patientId)}">FOLLOW-UP CARE PLAN</a></li>
				<li><a class="diagnosis" href="#diagnosis" data-url="@{CarePatien.diagnosis(patientId)}">DIAGNOSIS</a></li>
                <li><a href="#patient-info" data-url="@{CarePatien.patientInfo(patientId)}">INFO</a></li>
			</ul>
			<div class="tab-content">
                <div class="tab-pane active" id="summary">		
                    #{include '/CarePatien/summary.html' /}                    
                </div>
                <div class="tab-pane" id="appointment"></div>
                <div class="tab-pane" id="careteam"></div>
                <div class="tab-pane" id="medication"></div>
                <div class="tab-pane" id="treatmentplan"></div>
                <div class="tab-pane" id="followupplan"></div>
                <div class="tab-pane" id="diagnosis"></div>
                <div class="tab-pane" id="patient-info"></div>
			</div>
		</div>
	</div>
	<div id="ajax-content"></div>
</div>

<div class="modal" id="addEditAppointment" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">				
				<h4 class="modal-title" id="myModalLabel_appointment">ADD NEW APPOINTMENT</h4>
			</div>
			#{form @CarePatien.appointmentOperation() , id:'appointmentForm', class: 'form-horizontal' }
			<input type="hidden" name="operation" />
      		<input type="hidden" name="patientId" value="${patientId}"/>
      		<input type="hidden" name="id" />
			<div class="modal-body" style="overflow:hidden;">
				<p class="editNote"><span class="btn btn-default-small" style="float:left;margin-right: 10px;">CURRENT DATA</span> 
				<span style="float:left;margin-bottom: 10px;"><span class="editNoteDet" style="font-weight: bold;">Thursday May 10th 2014 9AM - LUPECTOMY</span> 
					<br><span> IF THIS IS NOT CORRECT, COMPLETE THE FORM BELOW</span>
				</span>
				</p>
    
				<div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Purpose of Appointment</label>
                        <div class="col-xs-8 form-group input-group">                           
                            <input type="text" id="appointment_purpose" name="purposeText" class="form-control nomargin" placeholder="i.e. 1st Appointment With Radiation Oncologist" required="required">
                                <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm" id="treatment_step_process">
                        <label class="col-xs-3 control-label" for="rt_schedule">Step in the Treatment Process</label>
                        <div class="col-xs-8 form-group input-group">                           
                            <select class="form-control nomargin" id="ts_process">
                                <option></option>
                                <option>First Appointment</option>
                                <option>Make Treatment Decision</option>
                                <option>Simulation</option>
                                <option>Appointment During Treatments</option>
                                <option>Post Treatment Appointment</option>                                
                            </select>
                        </div>
                </div>
                 <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Time</label>
                        <div class="col-xs-8 form-group input-group">
                           <input type="text" class="form-control timeField nomargin" name="time"> <!-- required="required" -->
<!--                            <span class="input-group-addon has-error"><i class="fa fa-star"></i></span> -->
                        </div>
                </div>
                 <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Date</label>
                        <div class="col-xs-8 form-group input-group">
                           <input type="text" class="form-control nomargin" id="hasDatepicker" name="schDate" required="required">
                           <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm" id="repeatWeeklyBtnDiv">
					<label class="col-xs-3 control-label" for="rt_schedule" style="padding-top: 0px;">Repeat Weekly</label>
					<div class="col-xs-8 form-group input-group">
						<input id="repeatWeeklyBtn" name="repeatWeeklyBtn" type="checkbox"/>
						<span id="appoinetmentrepeatError" class="txt-danger" style="float:right;"></span>
					</div>
				</div>
				<div id="repeatWeeklyBlock" style="display:none;width:100%;float: left;">
					<div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Starts on</label>
                        <div class="col-xs-2 form-group input-group" style="margin-bottom: 5px; padding-left: 0px;">
                           <input type="text" class="form-control nomargin" id="startsOn" name="startsOn" style="border-radius: 3px;">
                        </div>
                	</div>
					<div class="form-group form-group-sm">
                		<label class="col-xs-3 control-label" for="rt_schedule" style="padding-top: 0px;">Ends</label>
						<div class="col-xs-2 form-group input-group">
							<input id="endsNeverBtn" name="endsOnCheck" type="checkbox" data-value="never" value="never"/>&nbsp;Never<br>
						</div>
					</div>
					<div class="form-group form-group-sm">
						<label class="col-xs-3 control-label sr-only" for="rt_schedule"></label>
						<div class="col-xs-2 form-group" style="/* padding-left: 3px; */">
							<input id="endsAfterBtn" name="endsOnCheck" type="checkbox" data-value="after" value="after"/>&nbsp;After
						</div>
						<div class="col-xs-2 form-group" style="margin-left: -45px; margin-bottom: 5px;">
							<input type="text" class="form-control nomargin input-sm" id="occurences" name="occurences" disabled="disabled" style="border-radius: 3px; width: 60%;">
						</div>
						<div class="col-xs-1 form-group" style="margin-left: -45px; margin-bottom: 5px;">&nbsp;occurences.</div>
					</div>
					<div class="form-group form-group-sm">
						<label class="col-xs-3 control-label sr-only" for="rt_schedule"></label>
						<div class="col-xs-2 form-group" style="/* padding-left: 3px;  */margin-bottom: 5px;">
							<input id="endsOnBtn" name="endsOnCheck" type="checkbox" data-value="endsOn" value="endsOn"/>&nbsp;On
						</div>
						<div class="col-xs-2 form-group" style="margin-left: -45px; margin-bottom: 5px;">
							<input type="text" class="form-control nomargin" id="endsOnDate" name="endsOnDate" disabled="disabled" style="border-radius: 3px;">
						</div>
					</div>
				</div>
				
                 <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Center</label>
                        <div class="col-xs-8 form-group input-group">
                           <input type="text" class="form-control nomargin" value="Moffitt Cancer Center TVRH" name="center" required="required">
                           <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Physician/Nurse</label>
                        <div class="col-xs-8 form-group input-group">
                           #{if noteList != null}
								<input type="text" id="appointment_verified_members" name="membername" class="form-control nomargin" placeholder="i.e. Ryan Belen" required="required">
                                <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
							#{/if}
							#{else}
								No expert assigned
							#{/else}
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Address1</label>
                        <div class="col-xs-8 form-group input-group">
                          	<input type="text" class="form-control nomargin" value="1400 US Highway 441, Suite 540" name="address1" required="required">
                           	<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
				<div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Telephone</label>
                        <div class="col-xs-8 form-group input-group">
                          	<input type="text" class="form-control nomargin" name="phone">
                           	<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">City</label>
                        <div class="col-xs-8 form-group input-group">
                          	<input type="text" class="form-control nomargin" value="The Villages" name="city" required="required">
                           	<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">State</label>
                        <div class="col-xs-8 form-group input-group">
                          	<input type="text" class="form-control nomargin" value="FL" name="state" required="required">
                           	<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Zip Code</label>
                        <div class="col-xs-8 form-group input-group">
                          	<input type="text" class="form-control nomargin" value="32159" name="zip" required="required">
                           	<span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
      		</div>
      		<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        		<button type="submit" class="btn btn-default">SAVE</button>
				<input name="deleteAP" type="button" class="btn btn-default" value="DELETE"></input>
      		</div>
      		#{/form}
		</div>
	</div>
</div>

<div class="modal" id="addEditCareTeam" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
<!-- 				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button> -->
				<h4 class="modal-title" id="myModalLabel">ADD NEW CARE TEAM</h4>
			</div>
			<div class="modal-body">
			 <form class="form-horizontal form-condensed" role="form">
				<div class="form-group form-group-sm">
                    <label for="disease" class="col-xs-3 control-label">Center/Clinic Name</label>
                    <div class="col-xs-9">
                        <input type="text" class="form-control"/>
                    </div>
                </div>
				<div class="form-group form-group-sm">
                    <label for="disease" class="col-xs-3 control-label">Type of Care Team</label>
                    <div class="col-xs-9">
                        <select class="form-control">
								<option>Oncology</option>
							</select>
                    </div>
                </div>
                <div class="form-group form-group-sm">
                    <label for="disease" class="col-xs-3 control-label">Address</label>
                    <div class="col-xs-9">
                        <input type="text" class="form-control"/>
                    </div>
                </div>
                <div class="form-group form-group-sm">
                    <label for="disease" class="col-xs-3 control-label">City</label>
                    <div class="col-xs-9">
                        <input type="text" class="form-control"/>
                    </div>
                </div>
                <div class="form-group form-group-sm">
                    <label for="disease" class="col-xs-3 control-label">State</label>
                    <div class="col-xs-9">
                        <input type="text" class="form-control"/>
                    </div>
                </div>
                <div class="form-group form-group-sm">
                    <label for="disease" class="col-xs-3 control-label">Zip</label>
                    <div class="col-xs-9">
                        <input type="text" class="form-control"/>
                    </div>
                </div>
                </form>
      		</div>
      		<div class="modal-footer">
      			<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        		<button type="button" class="btn btn-default" data-dismiss="modal">SAVE</button>
      		</div>
		</div>
	</div>
</div>
<div class="modal" id="addEditCareMemberTeam" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="myModalLabel">ADD NEW CARE TEAM MEMBER</h4>
			</div>
			<div class="modal-body">
				<form class="form-horizontal form-condensed" role="form">
					<div class="form-group form-group-sm">
	                    <label for="disease" class="col-xs-3 control-label">&nbsp;</label>
	                    <div class="col-xs-9">
	                        <input type="checkbox"/> Primary team member
	                    </div>
	                </div>
					<div class="form-group form-group-sm">
	                    <label for="disease" class="col-xs-3 control-label">Name</label>
	                    <div class="col-xs-9">
	                        <input type="text" class="form-control"/>
	                    </div>
	                </div>
					<div class="form-group form-group-sm">
	                    <label for="disease" class="col-xs-3 control-label">Title</label>
	                    <div class="col-xs-9">
	                        <input type="text" class="form-control"/>
	                    </div>
	                </div>
					<div class="form-group form-group-sm">
	                    <label for="disease" class="col-xs-3 control-label">Telephone</label>
	                    <div class="col-xs-9">
	                        <input type="text" class="form-control"/>
	                    </div>
	                </div>
	                <div class="form-group form-group-sm">
	                    <div class="col-xs-12" style="text-align:center;">
	                        <img src="/public/images/top-p.png"/> + Click to add photo
	                    </div>
	                </div>
                </form>
      		</div>
      		<div class="modal-footer">
      			<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        		<button type="button" class="btn btn-default" data-dismiss="modal">SAVE</button>
      		</div>
		</div>
	</div>
</div>

<div class="modal" id="addEditmedication" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">				
				<h4 class="modal-title" id="myModalLabel">ADD NEW MEDICATION</h4>
			</div>
			#{form @CarePatien.medicationOperation() , id:'medicationForm'}
			<div class="modal-body">
				<input type="hidden" name="operation" />
      			<input type="hidden" name="id" />
   				<input type="hidden" name="patientId" value="${patientId}"/>
   				<input type="hidden" name="catlogId" />

   				<div class="form-group form-group-sm">
                        <label class="col-xs-4 control-label" for="rt_schedule">Generic Name</label>
                        <div class="col-xs-8 form-group input-group">
                           <input type="text" class="form-control nomargin" name="genericname" required/>
                           <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>

              	<div class="form-group form-group-sm">
                        <label class="col-xs-4 control-label" for="rt_schedule">Brand Name</label>
                        <div class="col-xs-8 form-group input-group">
                           <input type="text" class="form-control" name="brandname" required/>
                           <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-4 control-label" for="rt_schedule">Frequency</label>
                        <div class="col-xs-8 form-group input-group">
                           <input type="text" class="form-control" name="frequency"/>
                           <!-- <span class="input-group-addon has-error"><i class="fa fa-star"></i></span> -->
                        </div>
                </div>

                <div class="form-group form-group-sm">
                        <label class="col-xs-4 control-label" for="rt_schedule">Prescribing Physician</label>
                        <div class="col-xs-8 form-group input-group">
                        	<input type="text" class="form-control input-sm" name="memberid" id="memberid" placeholder="i.e. Dr. Jorge Freire" autocomplete="off">
                        </div>
                </div>
                 <div class="form-group form-group-sm" style="height:25px;">
                        <label class="col-xs-4 control-label" for="rt_schedule">Dates</label>
                        <div class="col-xs-8 form-group nopadding input-daterange" id="datepickerRange">
<!--                           <div class="col-xs-7 input-daterange" id="datepickerRange" > -->
			                    <input type="text" class="form-control input-sm" name="startDate"/>
			                    <span class="add-on">to</span>
			                    <input type="text" class="form-control input-sm" name="endDate"/>
<!-- 			                </div> -->
                        </div>
                </div>
                <div class="form-group form-group-sm">
                        <label class="col-xs-4 control-label" for="rt_schedule">Special Instructions</label>
                        <div class="col-xs-8 form-group input-group">
                           <textarea class="otherDetails" style="height: 60px;min-width: 370px;max-width: 370px;width: 370px;" name="otherdetails"></textarea>
                </div>
                </div>
				<table>
				</table>
	      		</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-default">SAVE</button>
					<input name="deleteMD" type="button" class="btn btn-default" value="DELETE"></input>	        		
	      		</div>
      		#{/form}
		</div>
	</div>
</div>

<div class="modal" id="addEditNote" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-m">
   <div class="modal-content col-xs-12 col-sm-12">
   #{form @CarePatien.noteOperation() , id:'noteForm' }
      	<input type="hidden" name="operation" />
      	<input type="hidden" name="id" />
   		<input type="hidden" name="patientId" value="${patientId}"/>
      		<div class="modal-header">        		
        		<h4 class="modal-title" id="myModalLabel_note">NEW NOTE</h4>
      		</div>
        	<div class="modal-body" style="display:block;">
                    <div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">TITLE/LABEL</label>
                        <div class="col-xs-9 form-group input-group">
                            <input type="text"  name="title" placeholder="i.e. Note for other care team members. Not for patients." class="form-control input-sm" required>
                            <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                    </div>
					<div class="form-group form-group-sm">
                        <label class="col-xs-3 control-label" for="rt_schedule">Note</label>
                        <div class="col-xs-9 form-group input-group">
                            <textarea class="form-control" style="height: 120px;width:100%;max-width: 370px;" name="description" required="required"></textarea>
                            <span class="input-group-addon has-error"><i class="fa fa-star"></i></span>
                        </div>
                    </div>
    		</div>
     		<div class="modal-footer col-xs-12 col-sm-12">
				<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
				<button type="submit" class="btn btn-default" data-next="3"> SAVE </button>
     			<input type="button" name="deleteNote" class="btn btn-default" data-next="3" value="DELETE"></input>       			
    		</div>
      #{/form}
		</div>
	</div>
</div>
<div class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" id="addRadiationTreatment">
	<div class="modal-dialog modal-lg">
	 <div class="modal-content col-xs-12 col-sm-12 panel-info">
			  			<div class="modal-header">
        		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        		<h4 class="modal-title" id="myModalLabel">ADD NEW TREATMENT</h4>
      		</div>
        	<div class="modal-body">
                    <form class="form-horizontal d_form" role="form">
                       <div class="form-group">
						<label class="col-sm-2 d_labl  ">Type of Radiation</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" placeholder="APBI" data-toggle="tooltip" data-placement="bottom" title="Tooltip for name">
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Dose</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" placeholder="60gy	" data-toggle="tooltip" data-placement="bottom" title="Tooltip for name">
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Schedule</label>
						<div class="col-sm-7">
							<select class="populate placeholder form-control" name="country">
									<option value="">5X Weekly</option>
									<option value="fr">3X Weekly</option>
									<option value="de">6X Weekly</option>
								</select>
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Dates</label>
						<div class="col-sm-7">
							<input type="text" id="input_date" class="form-control" style="width: 50px;float: left;margin-right: 10px;" placeholder="MM" size="2">
                            <input type="text" id="input_date" class="form-control" style="width: 50px;float: left;margin-right: 10px;" placeholder="DD" size="2">
                            <input type="text" id="input_date" class="form-control" style="width: 70px;float: left;margin-right: 10px;" placeholder="YYYY" size="4">
                            <span style="float:left;margin-right:10px;">-</span>
                            <input type="text" id="input_date" class="form-control" style="width: 50px;float: left;margin-right: 10px;" placeholder="MM" size="2">
                            <input type="text" id="input_date" class="form-control" style="width: 50px;float: left;margin-right: 10px;" placeholder="DD" size="2">
                            <input type="text" id="input_date" class="form-control" style="width: 70px;float: left;margin-right: 10px;" placeholder="YYYY" size="4">
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Side Effects</label>
						<div class="col-sm-7">
                        <div style="margin-bottom:12px; color:#999;"><i style="color:#C30;" class="fa fa-times"></i> Pain</div>
                            <select class="populate placeholder form-control" name="country">
									<option value="">Fatigue</option>
									<option value="fr">Demo</option>
									<option value="de">Demo</option>
								</select>
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Note</label>
						<div class="col-sm-7">
                        <textarea class="form-control" style="width:475px;"></textarea>
						</div>
					</div>
                    <br>
                    <div class="modal-footer">
						<div class="col-sm-7 col-sm-offset-5">
							<button type="submit" class="btn btn-primary d_btn-blue">SUBMIT NEW TREATMENT</button>
						</div>
					</div>
                    </form>
              </div>
		</div>
	</div>
</div>

<div class="modal fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" id="addChemoTreatment">
	<div class="modal-dialog modal-lg">
	 <div class="modal-content col-xs-12 col-sm-12 panel-info">
			  			<div class="modal-header">
        		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        		<h4 class="modal-title" id="myModalLabel">ADD NEW TREATMENT</h4>
      		</div>
        	<div class="modal-body">
	<div class="dialogModal_content">
     <div class="row">
	 <div class="col-md-12 panel-info">
			  			<div class="content-box-large box-with-header">
				  			<div>
                                <div class="row">
									<div class="col-sm-12">
                                    <div class="distress_01"><h3>NEW CHEMOTHERPAY TREATMENT</h3></div><br>
                    <form class="form-horizontal d_form" role="form">

                       <div class="form-group">
						<label class="col-sm-2 d_labl  ">Generic Name</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" placeholder="APBI" data-toggle="tooltip" data-placement="bottom" title="Tooltip for name">
						</div>
					</div>

                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Brand Name</label>
						<div class="col-sm-7">
							<input type="text" class="form-control" placeholder="60gy	" data-toggle="tooltip" data-placement="bottom" title="Tooltip for name">
						</div>
					</div>

                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Schedule</label>
						<div class="col-sm-7">
							<select class="populate placeholder form-control" name="country">
									<option value="">5X Weekly</option>
									<option value="fr">3X Weekly</option>
									<option value="de">6X Weekly</option>
								</select>
						</div>
					</div>
                    <div class="form-group">
						<label class="col-sm-2 d_labl ">Dose Reduction</label>
						<div class="col-sm-7">
							<select class="populate placeholder form-control" name="country">
									<option value="">50%</option>
									<option value="fr">20%</option>
									<option value="de">10%</option>
								</select>
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Date</label>
						<div class="col-sm-7">
							<input type="text" id="input_date" class="form-control" placeholder="DD" style="width:50px;float:left;margin-right:10px;"/>
                            <input type="text" id="input_date" class="form-control" placeholder="MM" style="width:50px;float:left;margin-right:10px;"/>
                           	<input type="text" id="input_date" class="form-control" placeholder="YYYY" style="width:70px;float:left;margin-right:10px;"/>
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Side Effects</label>
						<div class="col-sm-7">
                           <div style="margin-bottom:12px; color:#999;"><i style="color:#C30;" class="fa fa-times"></i> Pain</div>
                            <select class="populate placeholder form-control" name="country">
									<option value="">Fatigue</option>
									<option value="fr">Demo</option>
									<option value="de">Demo</option>
								</select>
						</div>
					</div>
                       <div class="form-group">
						<label class="col-sm-2 d_labl ">Note</label>
						<div class="col-sm-7">
                        <textarea class="form-control" rows="5">

                        </textarea>
						</div>
					</div>
                    <div class="modal-footer">
						<div class="col-sm-7 col-sm-offset-5">
							<button type="submit" class="btn btn-primary d_btn-blue">SUBMIT NEW TREATMENT</button>
						</div>
					</div>
                    </form>
                        </div>
   								</div>
							</div>
						</div>
			  		</div>
				 </div>
				</div>
              </div>
		</div>
	</div>
</div>


<div class="modal fade" id="addEditCaner" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog modal-lg">
   <div class="modal-content col-xs-12 col-sm-12">
      	<input type="hidden" name="operation" />
      	<input type="hidden" name="id" />
   		<input type="hidden" name="patientId" value="${patientId}"/>
      		<div class="modal-header">
        		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        		<h4 class="modal-title" id="myModalLabel">EDIT CANCER TYPE</h4>
      		</div>
        	<div class="modal-body">
        	<p class="editNote"><span class="btn btn-default-small">CURRENT DATA:</span> <span style="font-size: 20px;">ER+, PR+, HER2- |</span> IF THIS IS NOT CORRECT, COMPLETE THE FORM BELOW</p>

        	<table style="border: 1px solid #ccc; margin-top: 30px; width: 100%;">
        		<tr>
        			<td colspan="2"><h4 class="modal-title" id="myModalLabel">CANCER TYPE INFORMATION</h4></td>
        		</tr>
        		<tr>
        			<td style="width: 50%; border-right: 1px solid #CCC; padding-right: 20px;"><table style="width:100%;">
        		<tr>
        			<td><span style="line-height: 16px;">Hormone and Her2 Status</span></td>
        			<td>
        			<div class="input-group">
						<select class="form-control">
        					<option>ER+</option>
        					<option>ER-</option>
        				</select>
        				</div>
        				<div class="input-group" style="margin: 5px 0;">
        				<select class="form-control">
        					<option>PR+</option>
        					<option>PR-</option>
        				</select>
        				</div>
        				<div class="input-group">
        				<select class="form-control">
        					<option>HER2+</option>
        					<option>HER2-</option>
        				</select>
        				</div>
        				</td>
        		</tr>
        		<tr>
        			<td>Type&nbsp;</td>
        			<td>
        			<div class="input-group">
        				<select class="form-control">
        					<option>Invasive Ductal Carcinoma</option>
        				</select>
        				</div>
        			</td>
        		</tr>
        		<tr>
        			<td>Recurrence&nbsp;</td>
        			<td>
        			<div class="input-group">
        				<select class="form-control">
        					<option>NO</option>
        					<option>YES</option>
        				</select>
        				</div>
        			</td>
        		</tr>
        		<tr>
        			<td>Symptoms&nbsp;</td>
        			<td>
        			<div class="input-group">
        				Lump in Breast
        				</div>
        			</td>
        		</tr>
        		<tr>
        			<td>Side Effects&nbsp;</td>
        			<td>
        			<div class="input-group">
        				<select class="form-control">
        					<option>Rash on Breast</option>
        					<option>Other</option>
        				</select>
        				</div>
        			</td>
        		</tr>
        		</table></td>
        			<td style="width:50%;vertical-align: top;padding-left: 20px;">
        			Aditional Comments<br/>
        				<textarea style=" height: 300px;width: 360px;"></textarea>
        			</td>
        		</tr>
        	</table>
    		</div>
     		<div class="modal-footer col-xs-12 col-sm-12" >
       			<button type="submit" class="btn btn-default" data-next="3">&nbsp;&nbsp;&nbsp;&nbsp; UPDATE DATA &nbsp;&nbsp;&nbsp;&nbsp;</button>
    		</div>
		</div>
	</div>
</div>

<div class="modal fade" id="editAppointmentOccurences" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Edit recurring appointments</h4>
      </div>
      <div class="modal-body" style="overflow:hidden;">
        <div class="col-xs-12 col-sm-12" id="bodyText" style="padding: 10px 0px;">Would you like to change only this appointment, all appointments in the series?</div>
        <div class="col-xs-12 col-sm-12" style="padding: 10px 0px;">
        	<div class="col-xs-3 col-sm-3">
  			<button type="button" class="btn btn-default btn-sm" value="onlyThisEvent" id="onlyThisEvent">Only this event</button>
  			</div>
  			<div class="col-xs-9 col-sm-9">
  			<span>&nbsp;All other appointments in the series will remain the same.</span>
  			</div>
		</div>
		<div class="col-xs-12 col-sm-12" style="padding: 10px 0px;">
			<div class="col-xs-3 col-sm-3">
  			<button type="button" class="btn btn-default btn-sm" value="allEvents" id="allEvents">All events</button>
  			</div>
  			<div class="col-xs-9 col-sm-9">
  			<span>&nbsp;All appointments in the series will be changed. Any changes made to other appointments will be kept.</span>
  			</div>
		</div>
		<div class="col-xs-12 col-sm-12" style="padding: 10px 0px;">
		NOTE: Appointment date change will only reflect to current appointment.
		</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script>
var docs = [];
var timeArray = ["8 AM","8.15 AM","8.30 AM","8.45 AM","9 AM","9.15 AM","9.30 AM","9.45 AM","10 AM","10.15 AM","10.30 AM","10.45 AM","11 AM","11.15 AM","11.30 AM","11.45 AM","12 noon","12.15 PM","12.30 PM",
				"12.45 PM","1 PM","1.15 PM","1.30 PM","1.45 PM","2 PM","2.15 PM","2.30 PM","2.45 PM","3 PM","3.15 PM","3.30 PM","3.45 PM","4 PM","5.15 PM","5.30 PM","5.45 PM","6 PM"];
$(document).ready(function() {
    $('#tabs').on('shown.bs.tab', function(e) {
        $('body').scrollTop(0);        
    });
	var loadTabContent = function(e) {
		var url = $(this).attr("data-url");
        var href = this.hash; // our target url        
        var pane = $(this);    
        // ajax load from data-url
        $(href).load(url,function(result){
            pane.tab('show');
            //  Add tooltip feature to table [Start]
            var divs = $('table.table td div');
            if (divs.length) {
                divs.addTooltipsToTable();

                $(window).resize(function(){
                    divs.addTooltipsToTable();
                });
            }
            //  Add tooltip feature to table [End]                
            if (href == '#summary') {
                $('a.date-range[days="30"]').click();
            }
        });
        
        var params = {};
        params['patientId'] = "0";
        params['formOf'] = "doctors";
        $.post('/CarePatien/fupTemplateData', params, function(data) {
        	 var tmp = [];
             for (var id in data.doctors) {
                 tmp.push(data.doctors[id]);
             }
            $("#memberid").data("careMembers", data.doctors);
            $("#memberid").typeahead({
            	minLength: 0 ,
                source: tmp
            });
        }, "json");
	}

	$('#tabs a').click(loadTabContent);


	if ( window.location.hash && $('#tabs li a.'+window.location.hash.substring(1)).length ) {
		$('#tabs li a.'+window.location.hash.substring(1)).click();
	}

	$("#addEditmedication input[name='genericname']").autocomplete({source:  "/carePatien/autoCompleteMedic", minLength: 0,select: function( event, ui ) {
// 		if($("#addEditmedication input[name='operation']").val() == 'add') {
	      	$("#addEditmedication input[name='brandname']").val(ui.item.brandname);
    	  	$("#addEditmedication input[name='frequency']").val(ui.item.frequency);
			$("#addEditmedication textarea[name='otherdetails']").val(ui.item.specialinstruction);
			$("#addEditmedication input[name='catlogId']").val(ui.item.id);
// 			}
    	}
	});

// 	$("input.timeField").autocomplete({source: timeArray,minLenght:1 });
	$("input.timeField").typeahead({ source: timeArray,minLength: 0 }); 
	$('#hasDatepicker').datepicker({defaultDate: +1 ,minDate:"+1d",autoclose:true}).on('changeDate', function(e){
        $("#startsOn").val($(this).val());
    });

	$('#datepickerRange').datepicker({
		defaultDate: +1 ,minDate:"+1d",          
        format: "mm/dd/yyyy",
        forceParse:false,
        autoclose: true,
        forceParse: false,
        keyboardNavigation: false,
        doValidate: false
    });

	$('body').on('click', 'button.medicationBtn', function() {
		operationMedication('add');
	});
	$('body').on('click', 'button.noteBtn', function() {
		operationNote('add');
	});

	$('body').on('click', 'button.appointmentBtn', function() {
		operationAppointment('add');
	});

	$('body').on('click', 'button.careTeamBtn', function() {
		operationCareTeam('add');
	});

	$('body').on('click', 'img.medicineImg', function() {
    	$("#image_file_input").trigger( "click" );
    	currImage = this;
    	esnTemp = $(this).data("id");
    	$("#uploadId").val(esnTemp);
	});
	$('body').on('click', 'a.removeInstruction', function() {
		var idTemp = $(this).data("id");
    	var formURL = "/carePatien/medicationOperation";
		var postData = {operation:"removeMethod",'id':idTemp};
		$.post(formURL, postData, function( data ) {
// 			var current_index = $("#tabs").tabs('option', 'active');
// 			$("#tabs").tabs('load',current_index);
			$('#tabs li.active a').click();
		});
	});

	$('body').on('click', 'a.addInstruction', function() {
    	var idTemp = $(this).data("id");
    	var formURL = "/carePatien/medicationOperation";
		var postData = {operation:"addMethod",'id':idTemp};
		$.post(formURL, postData, function( data ) {
// 			var current_index = $("#tabs").tabs('option', 'active');
// 			$("#tabs").tabs('load',current_index);
			$('#tabs li.active a').click();
		});
	});

	$('body').on('click', 'ul.pagination li', function() {
		$(this).parent().find("li").removeClass("active");
		$(this).addClass("active");
		var type = $(this).data('type');
		var pageNo = $(this).data('seq');
		$.post("/carepatien/appointmentNextPage", {  'patientId': ${patientId}, 'pageId': pageNo, 'type': type}, function( data ) { 
			$("#"+type+"Table").html(data);
			$('html,body').animate({
				scrollTop: $("."+type).offset().top -160
			}, 500);
		});
	});

	$('#medicationForm').submit(function(event) {
		var members =  $("#memberid").data("careMembers");
		var memNameTmp  =  $("#addEditmedication #memberid").val();
		var postData = $("#medicationForm").serializeArray();
		var verified = false;
		for (var id in members) {
			if(members[id] == memNameTmp) {
				postData["careMembername"] =  id;
				postData.push({name:'careMembername',value:id});
				verified = true;
				break;
			}
		}
		if (!verified) {
			postData.push({name:'careMembername',value:null});
		}
		var formURL = $("#medicationForm").attr("action");
		$.post(formURL, postData, function( data ) {
			$('#addEditmedication').modal('hide');
			$('#tabs li.active a').click();
		});
 		event.preventDefault();
	});


	$('#appointmentForm').submit(function(event) {
        
        if($("#appointmentForm input[name='operation']").val() == 'add'){
    		var postData = $("#appointmentForm").serializeArray();
            var $avm = $('#appointment_verified_members');
            var $ap = $('#appointment_purpose');
            var membername = $avm.val();
            var members = $avm.data("careMembers");
            var verified = false;
            for (var id in members) {
                if(members[id] == membername) {
                    $avm.attr("careMemberId", id); 
                    verified = true;
                    break;
                }
            }
            if (!verified) {
                $avm.removeAttr("careMemberId");
            }        
            postData.push({name: "memberid", value: $avm.attr("careMemberId") || 0});
            
            var purposes = $ap.data("purposes");
            var purpose_text = $.trim($ap.val());
            var definedPurpose = false;
            var purpose = 0;
            for (var i = 0; i < purposes.length; i++) {
                if (purposes[i].name == purpose_text) {
                    definedPurpose = true;
                    purpose = purposes[i].id;
                    break;
                }
            }
            postData.push({name: "treatmentProcessStep", value: $("#ts_process option:selected").text()});    
            postData.push({name: "purpose", value: purpose});
            
			if($("#repeatWeeklyBtn").prop('checked')==true) {
            	var schDate = $("#appointmentForm input[name='schDate']").val();
        		var startsOn = $("#appointmentForm input[name='startsOn']").val();
        		
        		var from = schDate.split("/");
                var mySchDate = new Date(from[2], (from[0]/1) - 1, from[1]);

                from = startsOn.split("/");
                var myStartsOn = new Date(from[2], (from[0]/1) - 1, from[1]);
                if(myStartsOn == 'Invalid Date') {
                	$("#appoinetmentrepeatError").html("Invalid Start date.");
                	return false;
                } else if (myStartsOn < mySchDate) {
                	$("#appoinetmentrepeatError").html("Start date is less than Scheduled date.");
                    $("#appointmentForm input[name='startsOn']").focus();
                    return false;
                } else if($("#appointmentForm input[name='endsOnCheck']").val() == '') {
                	$("#appoinetmentrepeatError").html("Please select end option.");
                	return false;
                } else if($("#appointmentForm input[name='endsOnCheck']").val() == 'after' && ($("#appointmentForm input[name='occurences']").val() == '' || isNaN($("#appointmentForm input[name='occurences']").val()))) {
                	$("#appoinetmentrepeatError").html("Please provide number of occurences.");
                	return false;
                } else if($("#appointmentForm input[name='endsOnCheck']").val() == 'endsOn' ) {
 					from = $("#appointmentForm input[name='endsOnDate']").val().split("/");
                	var	myEndsOne = new Date(from[2], (from[0]/1) - 1, from[1]);
                	if(myEndsOne == 'Invalid Date') {
                		$("#appoinetmentrepeatError").html("Invalid End date.");
                    	return false;
                	} else if (myEndsOne < myStartsOn) {
                		$("#appoinetmentrepeatError").html("End date is less than Scheduled date.");
                    	return false;
                	} else {
                		$("#appoinetmentrepeatError").html("");
                	}
                } else {
                	$("#appoinetmentrepeatError").html("");
                }
            }
        	var formURL = $("#appointmentForm").attr("action");
    		$.post(formURL, postData, function( data ) {
    			$('#addEditAppointment').modal('hide');
    			$('#tabs li.active a').click();
    		});
        } else if($("#appointmentForm").attr('appointmentgroupid') == '1') {
	        	if($("#appointmentForm input[name='operation']").val() == 'edit'){
	        		$('#editAppointmentOccurences #myModalLabel').html('Edit recurring appointments');
	        		$('#editAppointmentOccurences #bodyText').html('Would you like to change only this event or all events in the series?');
	        		$('#editAppointmentOccurences #onlyThisEvent + span').html('&nbsp;All other events in the series will remain the same.');
	        		$('#editAppointmentOccurences #onlyThisEvent + span').html('&nbsp;All events in the series will be changed. Any changes made to other events will be kept.');
	        	}else if($("#appointmentForm input[name='operation']").val() == 'delete'){
	        		$('#editAppointmentOccurences #myModalLabel').html('Delete recurring appointments');
	        		$('#editAppointmentOccurences #bodyText').html('Would you like to delete only this event or all events in the series?');
	        		$('#editAppointmentOccurences #allEvents + span').html('&nbsp;All other events in the series will remain.');
	        		$('#editAppointmentOccurences #allEvents + span').html('&nbsp;All events in the series will be deleted.');
	        	}
	        	$('#editAppointmentOccurences').appendTo("body").modal();
		} else {
				submitAppointmentForm();
        }
 		event.preventDefault();
	});

	// Load Sparkline plugin and run callback for draw Sparkline charts for dashboard(top of dashboard + plot in tables)
	LoadSparkLineScript(DrawSparklineDashboardNew);
	LoadSelect2Script(selectExpert);
});
selectExpert = function() {
	$('.memberselect').select2();
	$("#appointmentFormPurpose").select2();
}
var formatDate = function(date, format) {
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        if (day < 10) {
            day = '0' + day;
        }
        if (month < 10) {
            month = '0' + month;
        }
        format = format.replace('yyyy', year);
        format = format.replace('mm', month);
        format = format.replace('dd', day);
        return format;
    };
operationMedication = function(operation,id) {
	if(operation == 'edit') {
		var formURL = "/carePatien/patientMedication";
		var postData = {'id':id};
		$.post(formURL, postData, function( data ) {
			if(data != '.') {
				$("#myModalLabel").html("EDIT MEDICATION");
				$("#addEditmedication input[name='operation']").val("edit");
				$("#addEditmedication input[name='id']").val(data.id);
				$("#addEditmedication input[name='genericname']").val(data.medicine.genericname);
				$("#addEditmedication input[name='brandname']").val(data.medicine.brandname);
				$("#addEditmedication input[name='frequency']").val(data.frequency);
				//Jan 20, 2014 12:09:00 AM
				//var d = moment(data.startdate, 'MMM DD, YYYY hh:mm:ss A');
				/* if(moment(data.startdate, 'MMM DD, YYYY hh:mm:ss A').isValid())
					$("#addEditmedication input[name='startDate']").val(moment(data.startdate, 'MMM DD, YYYY hh:mm:ss A').format('MM/DD/YYYY'));
				else  */if(moment(data.startdate, 'MM/DD/YYYY',true).isValid())
					$("#addEditmedication input[name='startDate']").val(moment(data.startdate, 'MM/DD/YYYY').format('MM/DD/YYYY'));
				else
					$("#addEditmedication input[name='startDate']").val(data.startdate);

				//d = moment(data.enddate, 'MMM DD, YYYY hh:mm:ss A');
				
				/* if(moment(data.enddate, 'MMM DD, YYYY hh:mm:ss A').isValid())
					$("#addEditmedication input[name='endDate']").val(moment(data.enddate, 'MMM DD, YYYY hh:mm:ss A').format('MM/DD/YYYY'));
				else  */if(moment(data.enddate, 'MM/DD/YYYY',true).isValid())
					$("#addEditmedication input[name='endDate']").val(moment(data.enddate, 'MM/DD/YYYY').format('MM/DD/YYYY'));
				else
					$("#addEditmedication input[name='endDate']").val(data.enddate);

// 				$('#datepickerRange').datepicker({ startDate: data.startdate, endDate: data.enddate});    
				$('#datepickerRange').datepicker({
					startDate: data.startdate, endDate: data.enddate,
					defaultDate: +1 ,minDate:"+1d",          
			        format: "mm/dd/yyyy",
			        forceParse:false,
			        autoclose: true,
			        forceParse: false,
			        keyboardNavigation: false,
			        doValidate: false
			    });
				$("#addEditmedication input[name='deleteMD']").show();
				$("#addEditmedication input[name='deleteMD']").click(function() {
					operationMedication('delete',data.id);
				});

				$("#addEditmedication textarea[name='otherdetails']").val(data.specialinstruction);
				$("#addEditmedication input[name='memberid']").val(data.caremembername);
				$('#addEditmedication').appendTo("body").modal();
			} else {
				alert('Internal server error');
			}
		});
	} else if(operation == 'delete') {
		$("#addEditmedication input[name='operation']").val("delete");
		$("#addEditmedication input[name='id']").val(id);
		var postData = $("#medicationForm").serializeArray();
		var formURL = $("#medicationForm").attr("action");
		$.post(formURL, postData, function( data ) {
			$('#addEditmedication').modal('hide');
			$('#tabs li.active a').click();
		});
	} else {
		$("#myModalLabel").html("ADD NEW MEDICATION");
		$("#addEditmedication input[name='operation']").val("add");
		$("#addEditmedication input[name='id']").val("0");
		$("#addEditmedication input[name='genericname']").val("");
		$("#addEditmedication input[name='brandname']").val("");
		$("#addEditmedication input[name='frequency']").val("");
		$("#addEditmedication textarea[name='otherdetails']").val("");
		$("#addEditmedication input[name='catlogId']").val("0");
		$("#addEditmedication input[name='deleteMD']").hide();
		$("#addEditmedication input[name='memberid']").val("");
		$('#addEditmedication').appendTo("body").modal();
	}
}
operationNote = function(operation,id,title,desc, noteBy) {
    var userId = '${user.id}';
    $('#addEditNote').find('input[type="button"][name="deleteNote"]').hide();
	if(operation == 'edit') {
		$("#myModalLabel_note").html("EDIT NOTE");
		$("#noteForm input[name='operation']").val("edit");
		$("#noteForm input[name='id']").val(id);
		$("#noteForm input[name='title']").val(title);
		$("#noteForm input[name='deleteNote']").show();
		$("#noteForm input[name='deleteNote']").unbind();
		$("#noteForm input[name='deleteNote']").click(function(){
			operationNote('delete',id,'','');
		});
		$("#noteForm textarea[name='description']").val(desc);
		$('#addEditNote').appendTo("body").modal();
		if (noteBy != userId) {
		  $('#addEditNote').find('input[type="button"][name="deleteNote"]').hide();
		}
	} else if(operation == 'delete') {
		if(confirm('Do you want to delete the note')) {
			$("#noteForm input[name='operation']").val("delete");
			$("#noteForm input[name='id']").val(id);
			$("#noteForm").submit();
		}
	} else {
		$("#myModalLabel_note").html("ADD NOTE");
		$("#noteForm input[name='operation']").val("add");
		$("#noteForm input[name='id']").val("0");
		$("#noteForm input[name='title']").val("");
		$("#noteForm textarea[name='description']").val("");
		$("#noteForm input[name='deleteNote']").hide();
		$('#addEditNote').appendTo("body").modal();
	}
}
operationAppointment = function(operation, id) {
	
    var $avm = $('#appointment_verified_members');
    var $ap = $('#appointment_purpose');
    var initFlag = $avm.attr("init_flag");    
    if (!initFlag) {
        $avm.attr('init_flag', 1);
        $.post('/care/appointmentForm', {}, function (data) {
            var members = data.members; 
            var purposes = data.purposes;
            $avm.data("careMembers", members);
            $ap.data("purposes", purposes);
			$avm.data("phones", data.phones);
            var arr = [];                        
            for (var id in members) {
                arr.push(members[id]);
            }                              
            $avm.typeahead({
                source: arr,
                minLength: 0,
				updater: function(item) {
					var members = $avm.data('careMembers');
					var phones = $avm.data('phones');					
					for (var id in members) {
						if (members[id] == item) {
							$("#appointmentForm input[name='phone']").val(phones[id]);
							break;
						}
					}
					return item;
				}
	        });    
            var purposeList = [];
            var length = purposes.length;
            for (var i = 0; i < length; i++) {
                purposeList.push(purposes[i].name);
            }
            $ap.typeahead({
                source: purposeList,
                minLength: 0,
                updater: function(item) {
                    return item;
                }
            });
            $ap.blur(function(e) {
                var purposes = $ap.data("purposes");
                var purposetext = $.trim($ap.val());
                var definedPurpose = false;
                for (var i = 0; i < purposes.length; i++) {
                    if (purposes[i].name == purposetext) {
                        definedPurpose = true;
                        break;
                    }
                }
//                 if (definedPurpose) {
                    //$('#treatment_step_process').hide();
//                 }else 
                if(purposetext.length > 0) {
                    $('#treatment_step_process').show();
                }
            });
	    }, "json");
    }

	if(operation == 'edit') {
		var formURL = "/carePatien/patientAppointment";
		var postData = {'id':id};
		$.post(formURL, postData, function( data ) {
			if(data != '.') {
				$("#myModalLabel_appointment").html("EDIT APPOINTMENT");
				$("#appointmentForm input[name='operation']").val("edit");
				$("#appointmentForm input[name='id']").val(data.id);
				
				if(data.appointmentgroupid) {
					$("#appointmentForm").attr('appointmentgroupid', '1');
				} else {
					$("#appointmentForm").attr('appointmentgroupid', '0');
				}

				$ap.val(data.purposeText);
                if ('treatementStep' in data) {
                    $('#treatment_step_process option').each(function(index, elm) {
                        var text = $(elm).text();
                        if (text == data.treatementStep) {
                            $(elm).prop("selected", true);
                        }
                    });
                }
				$("#appointmentForm input[name='time']").val(data.appointmenttime);
				$("#appointmentForm input[name='phone']").val(data.phone);
				$("#appointmentForm input[name='schDate']").val($.datepicker.formatDate('mm/dd/yy', new Date(data.appointmentdate)));
// 				$("#appointmentForm input[name='schDate']").prop("disabled", true);

				$("#repeatWeeklyBtnDiv").hide();
				$("#repeatWeeklyBlock").hide();
				
				$("#appointmentForm input[name='center']").val(data.appointmentcenter);
                $avm.val(data.careMemberName);
				$("#appointmentForm input[name='address1']").val(data.addressid.line1);
				$("#appointmentForm input[name='city']").val(data.addressid.city);
				$("#appointmentForm input[name='state']").val(data.addressid.state);
				$("#appointmentForm input[name='zip']").val(data.addressid.zip);
				$("#appointmentForm input[name='deleteAP']").show();
				$("#appointmentForm input[name='deleteAP']").unbind();
				$("#appointmentForm input[name='deleteAP']").click(function(){
					operationAppointment('delete',data.id);
				});
 				$('#addEditAppointment .editNote span.editNoteDet').html($.datepicker.formatDate('DD M dd yy', new Date(data.appointmentdate)) + " " + data.appointmenttime + " - " + data.purpose);
				$('#addEditAppointment .editNote').show();
				$('#addEditAppointment').appendTo("body").modal();
			} else {
				alert('Internal server error');
			}
		});
	} else if(operation == 'delete') {
		//if(confirm('Do you want to delete the scheduled appointment.')) {
			$("#appointmentForm input[name='operation']").val("delete");
			$("#appointmentForm input[name='id']").val(id);
			$("#appointmentForm").submit();
		//}
	} else {
        $('#treatment_step_process').val('');
		$("#myModalLabel_appointment").html("ADD APPOINTMENT");
		$("#appointmentForm input[name='operation']").val("add");
		$("#appointmentForm input[name='id']").val("0");
		$("#appointmentFormPurpose").select2("val", "1");
		$("#appointmentForm input[name='time']").val("");
		
		$("#appointmentForm input[name='schDate']").val("");
		$("#appointmentForm input[name='schDate']").prop("disabled", false);

		$("#repeatWeeklyBtnDiv").show();
		$("#appointmentForm input[name='repeatWeeklyBtn']").prop("checked", false);
		$("#repeatWeeklyBlock").hide();
		$("#appointmentForm input[name='startsOn']").val("");
		$("#appointmentForm input[name='occurences']").val("");
		$("#appointmentForm input[name='occurences']").prop("disabled", true);
		
		$("#appointmentForm input[name='endsOnDate']").val("");
		$("#appointmentForm input[name='endsOnDate']").prop("disabled", true);
		$("#appointmentForm input[name='endsOnCheck']").prop("checked", false);
		$("#appointmentForm input[name='endsOnCheck']").val("");
		
		$("#appointmentForm input[name='center']").val("Moffitt Cancer Center TVRH");
		//$("#appointmentForm select[name='memberid']").val();
		//$("#appointmentForm select[name='memberid']").select2("val", $("#appointmentForm select[name='memberid'] option:eq(1)").val());
		$("#appointmentForm input[name='address1']").val("1400 U.S. Highway 441");
		$("#appointmentForm input[name='city']").val("The Villages");
		$("#appointmentForm input[name='state']").val("FL");
		$("#appointmentForm input[name='zip']").val("32159");
		$('#addEditAppointment .editNote').hide();
		$("#appointmentForm input[name='deleteAP']").hide();
		$('#addEditAppointment').appendTo("body").modal();
	}
}
operationCareTeam = function(operation, id) {
	$('#addEditCareTeam').appendTo("body").modal();
}

operationCareTeamMember = function(operation, id) {
	$('#addEditCareMemberTeam').appendTo("body").modal();
}
operationRadiationTreatment = function(operation, id) {
	$('#addRadiationTreatment').appendTo("body").modal();
}
operationChemoTreatment = function(operation, id) {
	$('#addChemoTreatment').appendTo("body").modal();
}

operationCancer = function(operation, id) {
	$('#addEditCaner').appendTo("body").modal();
}
$(document).ready(function() {
	$('#appointmentForm').validator();
	$('#medicationForm').validator();
	$('#noteForm').validator();
    $('a.date-range[days="30"]').click();    
});

function DrawSparklineDashboardNew(){
	$.ajax({ type: 'POST', url: '/care/distressData',
		data  : {patientId:${patientId}},
		success:function(data){
			var sparkline_table = [];
			for(var i =1 ; i<=10 ;i ++){
				if(data[i]!=null && data[i]!='' )
					sparkline_table.push(data[i]);
				else
					sparkline_table.push(0)
			}
			$('.td-graph').each(function(){
				$(this).sparkline(sparkline_table,{defaultPixelsPerValue: 13, minSpotColor: null, maxSpotColor: null, spotColor: null,
					height: 35,fillColor: false, lineWidth: 2, lineColor: '#FFF'});
			});
		}
	});
}
function uploadDone(name) {
	var frame = getFrameByName(name);
	if (frame) {
	    ret = frame.document.getElementsByTagName("body")[0].innerHTML;
	    ret = $.trim(ret);
	    if(ret == 'WF') {
			$(currImage).attr('src', "/public/plugins/tinymce/skins/lightgray/img/loader.gif");
			$("#error").dialog("option","title","Error");
			$("#error .valuelable").html("<div style='width':200px;'>Please upload correct image file.</div>");
			$("#error").dialog('open');
		} else if(ret != ''){
    		$(currImage).attr('src', "/image/showMedicine/"+esnTemp+"?t="+new Date().getTime());

		}
	}
}
var currImage;
var esnTemp;
function getFrameByName(name) {
	for (var i = 0; i < frames.length; i++)
	    if (frames[i].name == name)
	      return frames[i];
	  return null;
}

$(document).ready(function(){
	
	$('#startsOn').datepicker({defaultDate: +1 ,minDate:"+1d",autoclose:true})
    .on('changeDate', function(e){
        $("#hasDatepicker").val($(this).val());
    });
	$('#endsOnDate').datepicker({defaultDate: +1 ,minDate:"+1d",autoclose:true});
	
    if($("#repeatWeeklyBtn").prop('checked')==true) {
  		$("#repeatWeeklyBlock").show();	
  	} else {
  		$("#repeatWeeklyBlock").hide();
  	}
  	
  	$("#repeatWeeklyBtn").click(function(){
  		if($("#repeatWeeklyBtn").prop('checked')==true) {
  			$("#repeatWeeklyBlock").show();	
  		} else {
  			$("#repeatWeeklyBlock").hide();
  		}
  	});
  	
  	$("input[name='endsOnCheck']").click(function() {
  	    $("input[name='endsOnCheck']").prop("checked",false);
  	    $(this).prop("checked",true);
  	    var currValue = $(this).data('value');
  	    if($(this).data('value') == "never"){
  	    	$("#occurences").prop("disabled", true);
  	    	$("#endsOnDate").prop("disabled", true);
  	    	$("#appointmentForm input[name='endsOnCheck']").val(currValue);
  	    }else if($(this).data('value') == "after"){
  	    	$("#occurences").prop("disabled", false);
  	    	$("#endsOnDate").prop("disabled", true);
  	    	$("#appointmentForm input[name='endsOnCheck']").val(currValue);
  	    }else if($(this).data('value') == "endsOn"){
  	    	$("#occurences").prop("disabled", true);
  	    	$("#endsOnDate").prop("disabled", false);
  	    	$("#appointmentForm input[name='endsOnCheck']").val(currValue);
  	    }
  	});
  	
  	$('#onlyThisEvent').click(function(){
		var postData = $("#appointmentForm").serializeArray();
        var $avm = $('#appointment_verified_members');
        var $ap = $('#appointment_purpose');
        var membername = $avm.val();
        var members = $avm.data("careMembers");
        var verified = false;
        for (var id in members) {
            if(members[id] == membername) {
                $avm.attr("careMemberId", id); 
                verified = true;
                break;
            }
        }
        if (!verified) {
            $avm.removeAttr("careMemberId");
        }        
        postData.push({name: "memberid", value: $avm.attr("careMemberId") || 0});
        
        var purposes = $ap.data("purposes");
        var purpose_text = $.trim($ap.val());
        var definedPurpose = false;
        var purpose = 0;
        for (var i = 0; i < purposes.length; i++) {
            if (purposes[i].name == purpose_text) {
                definedPurpose = true;
                purpose = purposes[i].id;
                break;
            }
        }
        postData.push({name: "treatmentProcessStep", value: $("#ts_process option:selected").text()});    
        postData.push({name: "purpose", value: purpose});
		postData.push({name: "editOccurencesAction", value:"onlyThisEvent"});
    	
		var formURL = $("#appointmentForm").attr("action");
		$.post(formURL, postData, function( data ) {
			$('#editAppointmentOccurences').modal('hide');
			$('#addEditAppointment').modal('hide');
			$('#tabs li.active a').click();
		});
    });
    
    $('#allEvents').click(function(){
		var postData = $("#appointmentForm").serializeArray();
        var $avm = $('#appointment_verified_members');
        var $ap = $('#appointment_purpose');
        var membername = $avm.val();
        var members = $avm.data("careMembers");
        var verified = false;
        for (var id in members) {
            if(members[id] == membername) {
                $avm.attr("careMemberId", id); 
                verified = true;
                break;
            }
        }
        if (!verified) {
            $avm.removeAttr("careMemberId");
        }        
        postData.push({name: "memberid", value: $avm.attr("careMemberId") || 0});
        
        var purposes = $ap.data("purposes");
        var purpose_text = $.trim($ap.val());
        var definedPurpose = false;
        var purpose = 0;
        for (var i = 0; i < purposes.length; i++) {
            if (purposes[i].name == purpose_text) {
                definedPurpose = true;
                purpose = purposes[i].id;
                break;
            }
        }
        postData.push({name: "treatmentProcessStep", value: $("#ts_process option:selected").text()});    
        postData.push({name: "purpose", value: purpose});
		postData.push({name: "editOccurencesAction", value:"allEvents"});
		var formURL = $("#appointmentForm").attr("action");
		$.post(formURL, postData, function( data ) {
			$('#editAppointmentOccurences').modal('hide');
			$('#addEditAppointment').modal('hide');
			$('#tabs li.active a').click();
		});
    });
    
});

submitAppointmentForm = function() {
	var postData = $("#appointmentForm").serializeArray();
    var $avm = $('#appointment_verified_members');
    var $ap = $('#appointment_purpose');
    var membername = $avm.val();
    var members = $avm.data("careMembers");
    var verified = false;
    for (var id in members) {
        if(members[id] == membername) {
            $avm.attr("careMemberId", id); 
            verified = true;
            break;
        }
    }
    if (!verified) {
        $avm.removeAttr("careMemberId");
    }        
    postData.push({name: "memberid", value: $avm.attr("careMemberId") || 0});

    var purposes = $ap.data("purposes");
    var purpose_text = $.trim($ap.val());
    var definedPurpose = false;
    var purpose = 0;
    for (var i = 0; i < purposes.length; i++) {
        if (purposes[i].name == purpose_text) {
            definedPurpose = true;
            purpose = purposes[i].id;
            break;
        }
    }
    postData.push({name: "treatmentProcessStep", value: $("#ts_process option:selected").text()});    
    postData.push({name: "purpose", value: purpose});
    postData.push({name: "editOccurencesAction", value:"onlyThisEvent"});
	var formURL = $("#appointmentForm").attr("action");
	$.post(formURL, postData, function( data ) {
		$('#editAppointmentOccurences').modal('hide');
		$('#addEditAppointment').modal('hide');
		$('#tabs li.active a').click();
	});
}

</script>
